!function(t){t.bigfoot=function(o){function e(o,e){var n,a,r,i;o.each(function(){var o=t(this);r="#"+o.attr("href").split("#")[1],n=o.closest("sup"),a=o.find("sup"),n.length>0?(i=(n.attr("id")||"")+(o.attr("id")||""),e.push(n.attr({"data-footnote-backlink-ref":i,"data-footnote-ref":r}))):a.length>0?(i=(a.attr("id")||"")+(o.attr("id")||""),e.push(o.attr({"data-footnote-backlink-ref":i,"data-footnote-ref":r}))):(i=o.attr("id")||"",e.push(o.attr({"data-footnote-backlink-ref":i,"data-footnote-ref":r})))})}function n(t){if(t.is(":empty")||0==t.children(":not(.hidden)").length){var o=t.parent();"delete"===d.actionOriginalFN.toLowerCase()?t.remove():t.addClass("hidden").css({display:"none"}),n(o)}else if(t.children(":not(.hidden)").length==t.children("hr:not(.hidden)").length){var o=t.parent();"delete"===d.actionOriginalFN.toLowerCase()?t.remove():(t.children("hr").addClass("hidden").css({display:"none"}),t.addClass("hidden").css({display:"none"})),n(o)}}function a(t,o){o.indexOf(" ")>=0&&(o=o.trim().replace(/ +/g,"|").replace(/(.*)/g,"($1)"));var e="(s|&nbsp;)*<s*a[^#<]*#"+o+"[^>]*>(.*?)<s*/s*a>",n=new RegExp(e,"g");return t.replace(n,"").replace("[]","")}function r(t,o,e){for(var n,a,r=new RegExp("{{"+o+":([^}]*)}}","g");n=r.exec(t);)n[1]&&(a=e.attr(n[1])||"",t=t.replace("{{"+o+":"+n[1]+"}}",a));return t}function i(o,e){return o=o||".footnote-content",e=e||d.popoverDeleteDelay,t(o).each(function(){var o=t('.footnote-button[data-footnote-identifier="'+t(this).attr("data-footnote-identifier")+'"]'),n=t(this);o.hasClass("changing")||(o.removeClass("active hover-instantiated click-instantiated").addClass("changing"),n.removeClass("active").addClass("disapearing"),setTimeout(function(){n.remove(),o.removeClass("changing")},e))}),t(o.replace(".footnote-content",".footnote-button"))}function l(t,o){o=o||.5;var e=t.find(".tooltip");e.length>0&&e.css({left:100*o+"%"})}function s(o){var e=parseFloat(o.outerWidth()),n=parseFloat(o.outerHeight()),a=c(),r=o.offset().top-t(window).scrollTop()+n/2,i=o.offset().left+e/2;return{topRoom:r,bottomRoom:a.height-r,leftRoom:i,rightRoom:a.width-i,leftRelative:i/a.width,topRelative:r/a.height}}function c(){var t=document.createElement("div");t.style.cssText="position: fixed;top: 0;left: 0;bottom: 0;right: 0;",document.documentElement.insertBefore(t,document.documentElement.firstChild);var o={width:t.offsetWidth,height:t.offsetHeight};return document.documentElement.removeChild(t),o}var f=jQuery("body").prop("class");f=f.replace(/.*?id-(\d+).*/g,"$1"),f=f||0;var d=t.extend({actionOriginalFN:"hide",activateOnHover:!1,allowMultipleFN:!1,appendPopoversTo:void 0,deleteOnUnhover:!1,hoverDelay:250,popoverDeleteDelay:500,popoverCreateDelay:100,positionNextToBlock:!0,positionContent:!0,preventPageScroll:!0,scope:!1,contentMarkup:'<aside class="footnote-content bottom"data-footnote-identifier="{{FOOTNOTEID}}" alt="Footnote {{FOOTNOTENUM}}"><div class="footnote-main-wrapper"><div class="footnote-content-wrapper">{{FOOTNOTECONTENT}}</div></div><div class="tooltip"></div></aside>',buttonMarkup:'<a href="#" class="footnote-button" name="note-{{FOOTNOTENUM}}-'+f+'" data-footnote-number="{{FOOTNOTENUM}}" data-footnote-identifier="{{FOOTNOTENUM}}" alt="See Footnote {{FOOTNOTENUM}}" rel="footnote"data-footnote-content="{{FOOTNOTECONTENT}}"><span class="footnote-circle" data-footnote-number="{{FOOTNOTENUM}}"></span><span class="footnote-circle"></span><span class="footnote-circle"></span></a>'},o),p=function(){var o;o=d.scope?d.scope+' a[href*="#"]':'a[href*="#"]';var i,l,s=t(o).filter(function(){var o=t(this),e=o.attr("rel");return e&&"null"!=e||(e=""),(o.attr("href")+e).match(/(fn|footnote|note)[:\-_\d]/gi)&&o.closest("[class*=footnote]:not(a):not(sup)").length<1}),c=[],f=[],p=[];e(s,f),t(f).each(function(){i=t(this).attr("data-footnote-ref").replace(":","\\:"),l=t(i).closest("li"),l.length>0&&(c.push(l),p.push(this))});for(var u=0;u<c.length;u++){var h,v=a(t(c[u]).html().trim(),t(p[u]).data("footnote-backlink-ref")).replace(/"/g,"&quot;").replace(/&lt;/g,"&ltsym;").replace(/&gt;/g,"&gtsym;"),g=+(u+1),m="";0!==v.indexOf("<")&&(v="<p>"+v+"</p>"),m=d.buttonMarkup.replace(/\{\{FOOTNOTENUM\}\}/g,g).replace(/\{\{FOOTNOTECONTENT\}\}/g,v),m=r(m,"SUP",t(p[u])),m=r(m,"FN",t(c[u])),h=t(m).insertAfter(t(p[u])),t(p[u]).remove();var O=t(c[u]).parent();switch(d.actionOriginalFN.toLowerCase()){case"delete":t(c[u]).remove(),n(O);break;case"hide":t(c[u]).addClass("hidden").css({display:"none"}),n(O)}}},u=function(o){if(d.activateOnHover){var e=t(o.target).closest(".footnote-button"),n='[data-footnote-identifier="'+e.attr("data-footnote-identifier")+'"]';if(e.hasClass("active"))return;if(e.addClass("hover-instantiated"),!d.allowMultipleFN){var a=".footnote-content:not("+n+")";i(a)}g(".footnote-button"+n).addClass("hover-instantiated")}},h=function(o){var e=t(o.target),n=e.closest(".footnote-button");$nearFootnote=e.closest(".footnote-content"),n.length>0?(o.preventDefault(),v(n)):$nearFootnote.length<1&&t(".footnote-content").length>0&&i()},v=function(t){t.blur();var o='data-footnote-identifier="'+t.attr("data-footnote-identifier")+'"';t.hasClass("changing")||(t.hasClass("active")?d.allowMultipleFN?i(".footnote-content["+o+"]"):i():(t.addClass("changing"),setTimeout(function(){t.removeClass("changing")},d.popoverCreateDelay),g(".footnote-button["+o+"]"),t.addClass("click-instantiated"),d.allowMultipleFN||i(".footnote-content:not(["+o+"])")))},g=function(o){if(o=o||".footnote-button",d.allowMultipleFN)var e=t(o).closest(".footnote-button");else var e=t(o+":first").closest(".footnote-button");e.each(function(){var o=t(this);try{var e=d.contentMarkup.replace(/\{\{FOOTNOTENUM\}\}/g,o.attr("data-footnote-number")).replace(/\{\{FOOTNOTEID\}\}/g,o.attr("data-footnote-identifier")).replace(/\{\{FOOTNOTECONTENT\}\}/g,o.attr("data-footnote-content").replace(/&gtsym;/,"&gt;").replace(/&ltsym;/,"&lt;"));e=r(e,"BUTTON",o)}finally{d.appendPopoversTo?$content=t(e).appendTo(d.appendPopoversTo+":first"):($nearestBlock=o.closest("p, div, pre, li, ul, section, article, main, aside"),$siblingFootnote=$nearestBlock.siblings(".footnote-content:last"),$content=t(e).insertAfter($siblingFootnote.length>0?$siblingFootnote:$nearestBlock)),$content.attr("data-bigfoot-max-height",$content.height()),T(),o.addClass("active"),$content.find(".footnote-content-wrapper").bindScrollHandler()}});var n=t(o.replace(".footnote-button",".footnote-content"));return setTimeout(function(){n.addClass("active")},d.popoverCreateDelay),n};t.fn.bindScrollHandler=function(){d.preventPageScroll&&t(this).on("DOMMouseScroll mousewheel",function(o){var e=t(this),n=e.scrollTop(),a=e[0].scrollHeight,r=parseInt(e.css("height")),i=e.closest(".footnote-content");if(e.scrollTop()>0&&e.scrollTop()<10&&i.addClass("scrollable"),i.hasClass("scrollable")){var l="DOMMouseScroll"==o.type?-40*o.originalEvent.detail:o.originalEvent.wheelDelta,s=l>0,c=function(){return o.stopPropagation(),o.preventDefault(),o.returnValue=!1,!1};return!s&&-l>a-r-n?(e.scrollTop(a),i.addClass("fully-scrolled"),c()):s&&l>n?(e.scrollTop(0),i.removeClass("fully-scrolled"),c()):void i.removeClass("fully-scrolled")}})};var m=function(o){d.deleteOnUnhover&&d.activateOnHover&&setTimeout(function(){t(o.target).closest(".footnote-content, .footnote-button");t(".footnote-button:hover, .footnote-content:hover").length<1&&i()},d.hoverDelay)},O=function(t){27==t.keyCode&&i()},T=function(){d.positionContent&&t(".footnote-content").each(function(){var o=t(this),e='data-footnote-identifier="'+o.attr("data-footnote-identifier")+'"',n=(o.find(".footnote-content-wrapper"),t(".footnote-button["+e+"]")),a=s(n),r=parseFloat(o.css("width")),i=parseFloat(o.css("margin-top")),c=+o.attr("data-bigfoot-max-height"),f=2*i+c,d=1e4;a.bottomRoom<f&&a.topRoom>a.bottomRoom?(o.css({top:"auto",bottom:a.bottomRoom+"px"}).addClass("top").removeClass("bottom"),d=a.topRoom-i-15,o.css({"transform-origin":100*a.leftRelative+"% 100%"})):(o.css({bottom:"auto",top:a.topRoom+"px"}).addClass("bottom").removeClass("top"),d=a.bottomRoom-i-15,o.css({"transform-origin":100*a.leftRelative+"% 0%"})),o.find(".footnote-content-wrapper").css({"max-height":Math.min(d,c)+"px"}),o.css({left:a.leftRoom-a.leftRelative*r+"px"}),l(o,a.leftRelative),parseInt(o.css("height"))<o.find(".footnote-content-wrapper")[0].scrollHeight&&o.addClass("scrollable")})},b=function(t,o){var e=d[t];return d[t]=o,e},C=function(t){return d[t]};return t(document).ready(function(){p(),t(document).on("mouseenter",".footnote-button",u),t(document).on("touchend click",h),t(document).on("mouseout",".hover-instantiated",m),t(document).on("keyup",O),t(window).on("scroll resize",T)}),{close:function(t,o){return i(t,o)},activate:function(t){return g(t)},reposition:function(){return T()},getSetting:function(t){return C(t)},updateSetting:function(t,o){return b(t,o)}}}}(jQuery);